title: '[全志A33]Uboot'
date: '2024-09-13 10:58:32'
updated: '2024-09-13 10:58:34'
tags:
  - uboot
categories:
  - uboot
---
## Env

cpu: allwinner a33
board: vstart
host: ubuntu 22.04

## uboot-sunxi仓库试错

**该章节并没有成功，所以如果想学习可以看看，只是想移植uboot就可以跳到下一个章节**

要移植uboot首先想到的肯定是全志的uboot仓库，先拉下来代码：

```bash
❯ git clone https://github.com/linux-sunxi/u-boot-sunxi 
❯ cd u-boot-sunxi 
```

使用一个A33芯片的板子的config进行配置并编译，经过测试, A33-OLinuXino_defconfig这个配置文件没支持emmc，只支持了sd，这里选择sinlinx的config，与vstar开发板相近：

```bash
❯ make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- Sinlinx_SinA33_defconfig
❯ make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- -j16
```

编译遇到如下错误，看起来很熟悉，好像当年搞f1c200s的时候也遇见了这个错误...

给lichee pi的仓库提交了pr，但已经过去了一年多，也没有离我...

该错误可通过该pr修复：[我是PR](https://github.com/Lichee-Pi/u-boot/pull/7)

```bash
usr/bin/ld: scripts/dtc/dtc-parser.tab.o:(.bss+0x10): multiple definition of `yylloc'; scripts/dtc/dtc-lexer.lex.o:(.bss+0x0): first defined here
  UPD     include/generated/version_autogenerated.h
  CC      lib/asm-offsets.s
  CC      arch/arm/lib/asm-offsets.s
collect2: error: ld returned 1 exit status
make[2]: *** [scripts/Makefile.host:106：scripts/dtc/dtc] 错误 1
make[2]: *** 正在等待未完成的任务....

```

```bash
  MKSUNXI spl/sunxi-spl.bin
  BINMAN  u-boot-sunxi-with-spl.bin
binman: No module named _libfdt
make: *** [Makefile:1348：u-boot-sunxi-with-spl.bin] 错误 1
```

```bash
❯ python -m pip list | grep pylibfdt
pylibfdt                           1.7.0.post1

```

```bash
❯ python -c "import pylibfdt; print(pylibfdt.__file__)"

Traceback (most recent call last):
  File "<string>", line 1, in <module>
ModuleNotFoundError: No module named 'pylibfdt'

```

```bash
=> mmc dev 0
Card did not respond to voltage select!
=> mmc dev 1
Card did not respond to voltage select!
=> mmc dev 0
MMC: no card present
=> mmc dev 1
Card did not respond to voltage select!

```