title: '[全志A33]Uboot'
date: '2024-09-13 10:58:32'
updated: '2024-09-13 10:58:34'
tags:
  - uboot
categories:
  - uboot
---
## Env

cpu: allwinner a33
board: vstart
host: ubuntu 22.04

## uboot-sunxi仓库试错

**该章节并没有成功，所以如果想学习可以看看，只是想移植uboot就可以跳到下一个章节**

要移植uboot首先想到的肯定是全志的uboot仓库，先拉下来代码：

```bash
❯ git clone https://github.com/linux-sunxi/u-boot-sunxi 
❯ cd u-boot-sunxi 
```

使用一个A33芯片的板子的config进行配置并编译，经过测试, A33-OLinuXino_defconfig这个配置文件没支持emmc，只支持了sd，这里选择sinlinx的config，与vstar开发板相近：

```bash
❯ make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- Sinlinx_SinA33_defconfig
❯ make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- -j16
```

编译遇到如下错误，看起来很熟悉，好像当年搞f1c200s的时候也遇见了这个错误...

给lichee pi的仓库提交了pr，但已经过去了一年多，也没有理我...

该错误可通过该pr修复：[我是PR](https://github.com/Lichee-Pi/u-boot/pull/7)

```bash
usr/bin/ld: scripts/dtc/dtc-parser.tab.o:(.bss+0x10): multiple definition of `yylloc'; scripts/dtc/dtc-lexer.lex.o:(.bss+0x0): first defined here
  UPD     include/generated/version_autogenerated.h
  CC      lib/asm-offsets.s
  CC      arch/arm/lib/asm-offsets.s
collect2: error: ld returned 1 exit status
make[2]: *** [scripts/Makefile.host:106：scripts/dtc/dtc] 错误 1
make[2]: *** 正在等待未完成的任务....
```

继续编译，到了最后阶段却遇到了如下错误：

```bash
  MKSUNXI spl/sunxi-spl.bin
  BINMAN  u-boot-sunxi-with-spl.bin
binman: No module named _libfdt
make: *** [Makefile:1348：u-boot-sunxi-with-spl.bin] 错误 1
```

检查python是否有这个module:

```bash
❯ python -m pip list | grep pylibfdt
pylibfdt                           1.7.0.post1
```

这时候已经开始怀疑是这个module的版本问题了，在[这里](https://pypi.org/project/pylibfdt/#history)找到了历史版本信息，逐个尝试安装还是不行...

最终在[这里](https://lore.kernel.org/buildroot/bug-11706-163@https.bugs.busybox.net%2F/T/)找到了问题的原因，是python版本的问题。

在[这里](https://blog.csdn.net/qq_34752070/article/details/125182978)找到了问题的解决方案，重新链接后解决问题。

通过fel进入将uboot启动之后发现emmc和sd卡都无法使用...

```bash
=> mmc dev 0
Card did not respond to voltage select!
=> mmc dev 1
Card did not respond to voltage select!
=> mmc dev 0
MMC: no card present
=> mmc dev 1
Card did not respond to voltage select!
```

fuck you allwinner! mainline start!

## mainline